import{u as Q,r as l,c as V,aA as Z,aB as J,aC as K,j as e,al as N,y as A,f as O,V as W,au as X,aD as Y,Z as ee,aE as ae,aF as se,a5 as te,a6 as ie,a7 as ne}from"./index-CEw6XCQe.js";const S={name:"",slug:"",description:"",parentId:null,icon:"",isActive:!0},oe=()=>{const{t:s}=Q(),[k,x]=l.useState(!1),[n,o]=l.useState(S),[d,b]=l.useState(null),[p,E]=l.useState(""),[I,j]=l.useState({}),{data:g,isLoading:L,isError:D,error:C,refetch:T}=V(void 0),[M,{isLoading:y}]=Z(),[P,{isLoading:f}]=J(),[R,{isLoading:$}]=K(),v=g?g.filter(a=>{var t;return a.name.toLowerCase().includes(p.toLowerCase())||((t=a.description)==null?void 0:t.toLowerCase().includes(p.toLowerCase()))}):[],w=v.filter(a=>!a.parentId),q=a=>v.filter(t=>t.parentId===a),z=a=>{j(t=>({...t,[a]:!t[a]}))},c=a=>{const{name:t,value:i,type:u}=a.target;if(u==="checkbox"){const r=a.target.checked;o(h=>({...h,[t]:r}))}else o(r=>({...r,[t]:i}))},G=a=>a.toLowerCase().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,""),U=a=>{const{value:t}=a.target;o(i=>({...i,name:t,slug:G(t)}))},m=()=>{o(S),b(null),x(!1)},_=a=>{o({name:a.name,slug:a.slug,description:a.description||"",parentId:a.parentId,icon:a.icon||"",isActive:a.isActive}),b(a.id),x(!0)},B=async a=>{if(window.confirm(s("admin.categories.deleteConfirmation","Are you sure you want to delete this category? This will also delete all subcategories and may affect listings.")))try{await R(a).unwrap()}catch(t){console.error("Failed to delete category:",t)}},H=async a=>{a.preventDefault();try{d?await P({id:d,...n}).unwrap():await M(n).unwrap(),m()}catch(t){console.error("Failed to save category:",t)}},F=({categories:a,level:t=0})=>e.jsx("ul",{className:`category-tree level-${t}`,children:a.map(i=>{const u=q(i.id),r=u.length>0,h=I[i.id];return e.jsxs("li",{className:"category-item",children:[e.jsxs("div",{className:"category-row",children:[r&&e.jsx("button",{className:"toggle-button",onClick:()=>z(i.id),children:h?e.jsx(ae,{}):e.jsx(se,{})}),!r&&e.jsx("span",{className:"toggle-placeholder"}),e.jsxs("div",{className:"category-info",children:[e.jsxs("span",{className:"category-name",children:[i.icon&&e.jsx("span",{className:"category-icon",children:i.icon}),i.name]}),!i.isActive&&e.jsx("span",{className:"inactive-badge",children:s("admin.categories.inactive","Inactive")})]}),e.jsxs("div",{className:"category-actions",children:[e.jsx("button",{className:"action-button view",onClick:()=>window.open(`/${i.slug}`,"_blank"),children:e.jsx(te,{})}),e.jsx("button",{className:"action-button edit",onClick:()=>_(i),children:e.jsx(ie,{})}),e.jsx("button",{className:"action-button delete",onClick:()=>B(i.id),disabled:$,children:e.jsx(ne,{})})]})]}),r&&h&&e.jsx(F,{categories:u,level:t+1})]},i.id)})});return L?e.jsx(N,{children:e.jsxs("div",{className:"admin-loading",children:[e.jsx(A,{}),e.jsx("p",{children:s("admin.categories.loading","Loading categories...")})]})}):D||!g?e.jsx(N,{children:e.jsxs("div",{className:"admin-error",children:[e.jsx(O,{size:48}),e.jsx("h2",{children:s("admin.categories.error","Error loading categories")}),e.jsx("p",{children:(C==null?void 0:C.toString())||s("admin.categories.tryAgain","Please try again later")}),e.jsx("button",{onClick:()=>T(),className:"retry-button",children:s("admin.categories.retry","Retry")})]})}):e.jsx(N,{children:e.jsxs("div",{className:"admin-categories",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:s("admin.categories.title","Category Management")}),e.jsxs("button",{className:"add-button",onClick:()=>{m(),x(!0)},children:[e.jsx(W,{}),s("admin.categories.addNew","Add New Category")]})]}),e.jsxs("div",{className:"categories-actions",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:s("admin.categories.search","Search categories..."),value:p,onChange:a=>E(a.target.value)}),e.jsx(X,{})]}),e.jsx("button",{className:"expand-all-button",onClick:()=>{const a=v.reduce((t,i)=>(t[i.id]=!0,t),{});j(a)},children:s("admin.categories.expandAll","Expand All")}),e.jsx("button",{className:"collapse-all-button",onClick:()=>j({}),children:s("admin.categories.collapseAll","Collapse All")})]}),e.jsx("div",{className:"categories-container",children:w.length>0?e.jsx(F,{categories:w}):e.jsxs("div",{className:"empty-state",children:[e.jsx(Y,{size:36}),e.jsx("p",{children:s("admin.categories.noCategories","No categories found. Create a new category to get started.")})]})}),k&&e.jsxs("div",{className:"category-form-container",children:[e.jsx("div",{className:"form-overlay",onClick:m}),e.jsxs("div",{className:"category-form",children:[e.jsx("h2",{children:d?s("admin.categories.editCategory","Edit Category"):s("admin.categories.newCategory","New Category")}),e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:[s("admin.categories.name","Name"),"*"]}),e.jsx("input",{type:"text",id:"name",name:"name",value:n.name,onChange:U,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"slug",children:[s("admin.categories.slug","Slug"),"*"]}),e.jsx("input",{type:"text",id:"slug",name:"slug",value:n.slug,onChange:c,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:s("admin.categories.description","Description")}),e.jsx("textarea",{id:"description",name:"description",value:n.description,onChange:c,rows:3})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"parentId",children:s("admin.categories.parent","Parent Category")}),e.jsxs("select",{id:"parentId",name:"parentId",value:n.parentId||"",onChange:c,children:[e.jsx("option",{value:"",children:s("admin.categories.noParent","No Parent (Root Category)")}),g.map(a=>d!==a.id&&e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"icon",children:s("admin.categories.icon","Icon")}),e.jsx("input",{type:"text",id:"icon",name:"icon",value:n.icon,onChange:c,placeholder:"e.g. FiHome (React Icons name)"})]}),e.jsxs("div",{className:"form-group checkbox-group",children:[e.jsx("input",{type:"checkbox",id:"isActive",name:"isActive",checked:n.isActive,onChange:c}),e.jsx("label",{htmlFor:"isActive",children:s("admin.categories.active","Active")})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:m,children:s("admin.categories.cancel","Cancel")}),e.jsx("button",{type:"submit",className:"save-button",disabled:y||f,children:y||f?e.jsxs("div",{className:"saving-spinner",children:[e.jsx(A,{}),e.jsx("span",{children:s("admin.categories.saving","Saving...")})]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),s("admin.categories.save","Save Category")]})})]})]})]})]})]})})};export{oe as default};

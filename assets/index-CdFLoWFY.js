import{u as z,r as h,ax as O,aj as X,ak as B,ay as G,X as K,j as e,al as u,y as Q,f as V,au as q,L as y,az as F,a5 as J,e as W,U as Y,a6 as Z,a7 as D}from"./index-CEw6XCQe.js";import{f as ee,a as se}from"./date-DCUNxNu2.js";const ne=()=>{var v,b;const{t:i}=z(),[r,o]=h.useState(1),[l,d]=h.useState({}),[m,g]=h.useState(""),{data:t,isLoading:w,isError:C,error:c,refetch:k}=O({page:r,limit:10,...l}),[A,{isLoading:S}]=X(),[P,{isLoading:R}]=B(),[E,{isLoading:M}]=G(),[T,{isLoading:_}]=K(),j=()=>{d(s=>({...s,search:m})),o(1)},x=(s,n)=>{d(a=>({...a,[s]:n})),o(1)},p=s=>{o(s)},$=async s=>{try{await A(s).unwrap()}catch(n){console.error("Failed to approve listing:",n)}},I=async s=>{const n=prompt(i("admin.listings.rejectReason","Enter a reason for rejection (optional):"));try{await P({id:s,reason:n||void 0}).unwrap()}catch(a){console.error("Failed to reject listing:",a)}},H=async s=>{if(window.confirm(i("admin.listings.deleteConfirmation","Are you sure you want to delete this listing? This action cannot be undone.")))try{await E(s).unwrap()}catch(n){console.error("Failed to delete listing:",n)}},U=async(s,n)=>{try{await T({id:s,listing:{isFeatured:!n}}).unwrap()}catch(a){console.error("Failed to update featured status:",a)}};return w?e.jsx(u,{children:e.jsxs("div",{className:"admin-loading",children:[e.jsx(Q,{}),e.jsx("p",{children:i("admin.listings.loading","Loading listings...")})]})}):C||!t?e.jsx(u,{children:e.jsxs("div",{className:"admin-error",children:[e.jsx(V,{size:48}),e.jsx("h2",{children:i("admin.listings.error","Error loading listings")}),e.jsx("p",{children:c&&typeof c=="object"&&"message"in c?c.message:i("admin.listings.serverError","The server encountered an error. This could be due to maintenance or high traffic.")}),e.jsx("button",{onClick:()=>k(),className:"retry-button",children:i("admin.listings.retry","Retry")}),e.jsxs("div",{className:"filter-tabs",children:[e.jsx("button",{className:l.status?"":"active",onClick:()=>d(s=>({...s,status:void 0})),children:i("admin.all","All Listings")}),e.jsx("button",{className:l.status==="reported"?"active":"",onClick:()=>d(s=>({...s,status:"reported"})),children:i("admin.reported_listings","Reported Listings")}),e.jsx("button",{className:l.status==="featured"?"active":"",onClick:()=>d(s=>({...s,status:"featured"})),children:i("admin.featured_listings","Featured Listings")})]})]})}):e.jsx(u,{children:e.jsxs("div",{className:"admin-listings",children:[e.jsx("div",{className:"page-header",children:e.jsx("h1",{children:i("admin.listings.title","Listing Management")})}),e.jsxs("div",{className:"filters-section",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:i("admin.listings.search","Search listings..."),value:m,onChange:s=>g(s.target.value),onKeyPress:s=>s.key==="Enter"&&j()}),e.jsx("button",{onClick:j,children:e.jsx(q,{})})]}),e.jsxs("div",{className:"filter-controls",children:[e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{children:[i("admin.listings.filterStatus","Status"),":"]}),e.jsxs("select",{onChange:s=>x("status",s.target.value),value:l.status||"",children:[e.jsx("option",{value:"",children:i("admin.all","All")}),e.jsx("option",{value:"active",children:i("admin.listings.statusActive","Active")}),e.jsx("option",{value:"pending",children:i("admin.listings.statusPending","Pending")}),e.jsx("option",{value:"rejected",children:i("admin.listings.statusRejected","Rejected")}),e.jsx("option",{value:"inactive",children:i("admin.listings.statusInactive","Inactive")})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsxs("label",{children:[i("admin.listings.filterSort","Sort By"),":"]}),e.jsxs("select",{onChange:s=>x("sort",s.target.value),value:l.sort||"",children:[e.jsx("option",{value:"newest",children:i("admin.listings.sortNewest","Newest")}),e.jsx("option",{value:"oldest",children:i("admin.listings.sortOldest","Oldest")}),e.jsx("option",{value:"price-high",children:i("admin.listings.sortPriceHigh","Price (High to Low)")}),e.jsx("option",{value:"price-low",children:i("admin.listings.sortPriceLow","Price (Low to High)")})]})]}),e.jsx("button",{className:"reset-filters",onClick:()=>{d({}),g("")},children:i("admin.resetFilters","Reset Filters")})]})]}),e.jsxs("div",{className:"listings-table-container",children:[e.jsxs("table",{className:"listings-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:i("admin.listings.image","Image")}),e.jsx("th",{children:i("admin.listings.title","Title")}),e.jsx("th",{children:i("admin.listings.price","Price")}),e.jsx("th",{children:i("admin.listings.category","Category")}),e.jsx("th",{children:i("admin.listings.seller","Seller")}),e.jsx("th",{children:i("admin.listings.status","Status")}),e.jsx("th",{children:i("admin.listings.date","Date")}),e.jsx("th",{children:i("admin.listings.actions","Actions")})]})}),e.jsx("tbody",{children:(v=t==null?void 0:t.listings)==null?void 0:v.map(s=>{var n,a,f,N,L;return e.jsxs("tr",{children:[e.jsx("td",{className:"image-cell",children:e.jsx("div",{className:"listing-image",children:e.jsx("img",{src:s.featuredImage||((n=s.images)==null?void 0:n[0])||"/placeholder-image.jpg",alt:s.title})})}),e.jsx("td",{children:e.jsxs("div",{className:"listing-title",children:[e.jsx(y,{to:`/listings/${s.slug}`,target:"_blank",children:s.title}),s.isFeatured&&e.jsxs("span",{className:"featured-badge",children:[e.jsx(F,{}),i("admin.listings.featured","Featured")]})]})}),e.jsx("td",{children:ee(s.price,s.currency)}),e.jsx("td",{children:((a=s.category)==null?void 0:a.name)||"-"}),e.jsx("td",{children:e.jsxs(y,{to:`/admin/users/${(f=s.user)==null?void 0:f.id}`,className:"seller-link",children:[(N=s.user)==null?void 0:N.firstName," ",(L=s.user)==null?void 0:L.lastName]})}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${s.status}`,children:s.status})}),e.jsx("td",{children:se(s.createdAt)}),e.jsxs("td",{className:"actions-cell",children:[e.jsx("button",{className:"action-button view",onClick:()=>window.open(`/listings/${s.slug}`,"_blank"),title:i("admin.listings.view","View Listing"),children:e.jsx(J,{})}),e.jsx("button",{className:"action-button star",onClick:()=>U(s.id,!!s.isFeatured),disabled:_,title:s.isFeatured?i("admin.listings.unfeature","Remove Featured"):i("admin.listings.feature","Mark as Featured"),children:e.jsx(F,{})}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"action-button approve",onClick:()=>$(s.id),disabled:S,title:i("admin.listings.approve","Approve Listing"),children:e.jsx(W,{})}),e.jsx("button",{className:"action-button reject",onClick:()=>I(s.id),disabled:R,title:i("admin.listings.reject","Reject Listing"),children:e.jsx(Y,{})})]}),e.jsx("button",{className:"action-button edit",onClick:()=>window.open(`/admin/listings/${s.id}/edit`,"_blank"),title:i("admin.listings.edit","Edit Listing"),children:e.jsx(Z,{})}),e.jsx("button",{className:"action-button delete",onClick:()=>H(s.id),disabled:M,title:i("admin.listings.delete","Delete Listing"),children:e.jsx(D,{})})]})]},s.id)})})]}),((b=t==null?void 0:t.listings)==null?void 0:b.length)===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:i("admin.listings.noListings","No listings found matching your criteria.")})})]}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>p(r-1),disabled:r<=1,children:i("admin.prev","Previous")}),e.jsxs("span",{children:[i("admin.page","Page")," ",r," ",i("admin.of","of")," ",Math.ceil(((t==null?void 0:t.total)||0)/10)]}),e.jsx("button",{onClick:()=>p(r+1),disabled:r>=Math.ceil(((t==null?void 0:t.total)||0)/10),children:i("admin.next","Next")})]})]})})};export{ne as default};

import{j as e,R as G,L as k,u as K,a as re,i as le,r as o,k as oe,p as de,q as ce,t as ge,v as he,w as ue,x as me,H as pe,y as U,E as xe,z as V,B as J,C as je,D as _e,I as we,J as ve,K as fe}from"./index-CEw6XCQe.js";import{g as F}from"./imageUrl-1dNZjTSy.js";import{c as P}from"./index-CaFybOz9.js";const f=F("placeholder.jpg"),ke=F("user-placeholder.jpg"),T=(t,i)=>i.has(t),H=(t,i)=>{i.add(t)};class Ne extends G.Component{constructor(i){super(i),this.state={hasError:!1,error:null,errorInfo:null,isReporting:!1,reportSent:!1},this.reportError=this.reportError.bind(this)}static getDerivedStateFromError(i){return console.error("Error boundary caught:",i),{hasError:!0,error:i}}componentDidCatch(i,s){console.error("Error details:",i),console.error("Component stack:",s==null?void 0:s.componentStack),this.setState({errorInfo:s})}reportError(){var s,c,n;this.setState({isReporting:!0});const i={message:((s=this.state.error)==null?void 0:s.message)||"Unknown error",stack:(c=this.state.error)==null?void 0:c.stack,componentStack:(n=this.state.errorInfo)==null?void 0:n.componentStack,url:window.location.href,timestamp:new Date().toISOString()};setTimeout(()=>{console.error("Error report data:",i),this.setState({isReporting:!1,reportSent:!0})},800)}render(){var i;return this.state.hasError?e.jsx("div",{className:"listing-detail-page__error-container",children:e.jsxs("div",{className:"listing-detail-page__error-content",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"#e11d48",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),e.jsx("h3",{children:"Something went wrong"}),e.jsx("p",{className:"listing-detail-page__error-message",children:"We encountered an unexpected error while displaying this listing. Our team has been notified about this issue."}),e.jsx("div",{className:"listing-detail-page__error-details",children:e.jsxs("p",{className:"listing-detail-page__error-text",children:["Error: ",((i=this.state.error)==null?void 0:i.message)||"Unknown error"]})}),e.jsxs("div",{className:"listing-detail-page__error-actions",children:[e.jsx(k,{to:"/listings",className:"listing-detail-page__error-action listing-detail-page__error-action--secondary",children:"Back to listings"}),e.jsx("button",{className:"listing-detail-page__error-action listing-detail-page__error-action--primary",onClick:()=>window.location.reload(),children:"Reload page"})]}),e.jsx("div",{className:"listing-detail-page__error-report",children:this.state.reportSent?e.jsxs("div",{className:"listing-detail-page__error-report-success",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"#16a34a",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),"Thank you for reporting this issue"]}):e.jsx("button",{className:"listing-detail-page__error-report-button",onClick:this.reportError,disabled:this.state.isReporting,children:this.state.isReporting?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"listing-detail-page__error-spinner"}),"Sending report..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),"Report this issue"]})})})]})}):this.props.children}}const R=({src:t,alt:i,className:s,onLoad:c,onError:n})=>{const[u,l]=o.useState(!1),_=()=>{console.error(`SafeImage error loading: ${t}`),l(!0),n&&n()},j=u?f:t||f;return e.jsx("img",{src:j,alt:i,className:`${s} ${u?"image-error":""}`,onLoad:c,onError:_,crossOrigin:"anonymous"})},be=({t})=>e.jsx("div",{className:"listing-detail-page",children:e.jsx("div",{className:"listing-detail-page__container",style:{minHeight:"70vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(U,{size:"large",text:t("listing.loading")})})}),ye=({error:t,t:i,refetch:s})=>{const c=t?typeof t=="object"?JSON.stringify(t):String(t):"Data not available";return e.jsx("div",{className:"listing-detail-page",children:e.jsxs("div",{className:"listing-detail-page__container",children:[e.jsx(xe,{message:i("listing.notFound"),details:c,onRetry:()=>s()}),e.jsx("div",{className:"listing-detail-page__back",children:e.jsxs(k,{to:"/listings",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),i("common.backToListings")]})})]})})},Le=()=>{const[t,i]=o.useState(window.innerWidth);return o.useEffect(()=>{const s=()=>i(window.innerWidth);return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),{width:t}},Ce=G.memo(({images:t,featuredImage:i,onImageError:s,failedImagesCount:c})=>{const{t:n}=K(),{width:u}=Le(),l=u<=768,[_,j]=o.useState(0),d=g=>{j(g)},m=(g,h)=>{(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),j(h))},v=()=>{j(g=>g===t.length-1?0:g+1)},N=()=>{j(g=>g===0?t.length-1:g-1)},b=g=>{g.key==="ArrowRight"?v():g.key==="ArrowLeft"&&N()};return e.jsxs("div",{className:"listing-detail-page__gallery",id:"gallery-section",role:"region","aria-label":n("listing.imageGallery","Image Gallery"),children:[c>0&&e.jsxs("button",{className:"listing-detail-page__retry-button",onClick:()=>{window.location.reload()},"aria-label":n("listing.retryLoadImages","Retry loading images"),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("path",{d:"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"})}),n("listing.retryLoadImages","Retry loading images")]}),e.jsxs("div",{className:"listing-detail-page__main-image",tabIndex:0,onKeyDown:b,"aria-label":n("listing.mainImage","Main product image"),children:[e.jsx(R,{src:t[_]||i,alt:n("listing.productImage","Product image"),className:"listing-detail-page__image",onError:()=>s(t[_]||i)}),t.length>1&&e.jsxs("div",{className:"listing-detail-page__image-controls",children:[e.jsx("button",{className:"listing-detail-page__image-control listing-detail-page__image-control--prev",onClick:N,"aria-label":n("listing.previousImage","Previous image"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})}),e.jsx("button",{className:"listing-detail-page__image-control listing-detail-page__image-control--next",onClick:v,"aria-label":n("listing.nextImage","Next image"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})})]})]}),t.length>1&&e.jsxs("div",{className:"listing-detail-page__thumbnails",role:"tablist","aria-label":n("listing.imageThumbnails","Image thumbnails"),children:[t.slice(0,l?4:t.length).map((g,h)=>e.jsx("div",{className:`listing-detail-page__thumbnail ${h===_?"listing-detail-page__thumbnail--active":""}`,onClick:()=>d(h),onKeyDown:y=>m(y,h),tabIndex:0,role:"tab","aria-selected":h===_,"aria-label":n("listing.imageNumber","Image {{number}}",{number:h+1}),children:e.jsx(R,{src:g,alt:n("listing.thumbnailImage","Thumbnail image {{number}}",{number:h+1}),onError:()=>s(g)})},h)),l&&t.length>4&&e.jsx("div",{className:"listing-detail-page__thumbnail listing-detail-page__thumbnail--more",role:"button","aria-label":n("listing.moreImages","More images"),children:e.jsxs("span",{children:["+",t.length-4]})})]})]})}),Ee=({listing:t,t:i})=>t?e.jsxs("div",{className:"listing-detail-page__features",id:"features-section",children:[e.jsx("div",{className:"listing-detail-page__section-header",children:e.jsx("h2",{children:i("listing.features")})}),e.jsxs("div",{className:"listing-detail-page__features-grid",children:[t.condition&&e.jsxs("div",{className:"listing-detail-page__feature-item",children:[e.jsx("div",{className:"listing-detail-page__feature-icon",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"}),e.jsx("line",{x1:"16",y1:"8",x2:"2",y2:"22"}),e.jsx("line",{x1:"17.5",y1:"15",x2:"9",y2:"15"})]})}),e.jsxs("div",{className:"listing-detail-page__feature-content",children:[e.jsx("span",{children:i("listing.condition")}),e.jsx("strong",{children:i(`condition.${t.condition}`,t.condition)})]})]}),t.location&&e.jsxs("div",{className:"listing-detail-page__feature-item",children:[e.jsx("div",{className:"listing-detail-page__feature-icon",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]})}),e.jsxs("div",{className:"listing-detail-page__feature-content",children:[e.jsx("span",{children:i("listing.location")}),e.jsx("strong",{children:t.location})]})]}),t.createdAt&&e.jsxs("div",{className:"listing-detail-page__feature-item",children:[e.jsx("div",{className:"listing-detail-page__feature-icon",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]})}),e.jsxs("div",{className:"listing-detail-page__feature-content",children:[e.jsx("span",{children:i("listing.listedOn")}),e.jsx("strong",{children:je(t.createdAt)})]})]}),t.views!==void 0&&e.jsxs("div",{className:"listing-detail-page__feature-item",children:[e.jsx("div",{className:"listing-detail-page__feature-icon",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})}),e.jsxs("div",{className:"listing-detail-page__feature-content",children:[e.jsx("span",{children:i("listing.views")}),e.jsx("strong",{children:t.views})]})]})]})]}):null,Ie=({listing:t,showContactInfo:i,setShowContactInfo:s,isChangingStatus:c,t:n})=>e.jsxs("div",{className:"listing-detail-page__contact",children:[e.jsx("h3",{children:n("listing.contact")}),i?e.jsxs("div",{id:"contact-info-section",className:`listing-detail-page__contact-info ${i?"is-visible":""}`,"aria-live":"polite",children:[t.contactPhone&&e.jsxs("div",{className:"listing-detail-page__contact-info-item",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"})}),e.jsx("a",{href:`tel:${t.contactPhone}`,children:t.contactPhone})]}),t.contactEmail&&e.jsxs("div",{className:"listing-detail-page__contact-info-item",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),e.jsx("polyline",{points:"22,6 12,13 2,6"})]}),e.jsx("a",{href:`mailto:${t.contactEmail}`,children:t.contactEmail})]})]}):e.jsxs("button",{className:"listing-detail-page__contact-button",onClick:()=>s(!0),disabled:c,"aria-expanded":i,"aria-controls":"contact-info-section",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"})}),n("listing.showContact")]})]}),Se=({listing:t,getStatusBadgeClass:i,t:s})=>e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"listing-detail-page__title",children:t.title||""}),e.jsxs("div",{className:"listing-detail-page__meta",children:[e.jsx("div",{className:"listing-detail-page__price",children:V(t.price)}),t.isFeatured&&e.jsxs("div",{className:"listing-detail-page__featured-badge",children:[e.jsx(J,{}),s("listing.featured")]}),t.status&&e.jsxs("div",{className:"listing-detail-page__status",children:[e.jsxs("span",{className:"listing-detail-page__status-label",children:[s("listing.statusLabel"),":"]}),e.jsx("span",{className:`listing-detail-page__status-value ${i(t.status)}`,children:s(`listing.status.${t.status}`)})]})]})]}),De=({listing:t,canEdit:i,isAdmin:s,isChangingStatus:c,isDeleting:n,isFeaturing:u,handleStatusChange:l,handleDelete:_,setIsFeatureModalOpen:j,t:d})=>i?e.jsxs("div",{className:"listing-detail-page__actions",children:[e.jsxs(k,{to:`/listings/${t.id}/edit`,className:"listing-detail-page__actions-secondary",children:[e.jsx(_e,{}),d("common.edit")]}),t.status==="active"&&e.jsxs("button",{className:"listing-detail-page__actions-secondary",onClick:()=>l("sold"),disabled:c,children:[e.jsx(we,{}),d("listing.markAsSold")]}),t.status==="pending"&&s&&e.jsxs("button",{className:"listing-detail-page__actions-primary",onClick:()=>l("active"),disabled:c,children:[e.jsx(ve,{}),d("admin.approve")]}),t.status==="active"&&!t.isFeatured&&e.jsxs("button",{className:"listing-detail-page__actions-feature",onClick:()=>j(!0),disabled:c||u,children:[e.jsx(J,{}),d("listing.makeFeature")]}),e.jsxs("button",{className:"listing-detail-page__actions-danger",onClick:()=>{window.confirm(d("listing.confirmDelete"))&&_()},disabled:n||c,children:[e.jsx(fe,{}),d("common.delete")]})]}):null,Me=({description:t,t:i})=>{if(!t)return null;const s=()=>t.split(`
`).filter(Boolean).map((c,n)=>e.jsx("p",{children:c},n));return e.jsxs("div",{className:"listing-detail-page__description",id:"description-section",children:[e.jsx("div",{className:"listing-detail-page__section-header",children:e.jsx("h2",{children:i("listing.description")})}),e.jsx("div",{className:"listing-detail-page__description-content",children:s()})]})},Fe=({listing:t,t:i})=>t?e.jsxs("div",{className:"listing-detail-page__breadcrumbs",children:[e.jsx(k,{to:"/",children:i("common.home")}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})}),e.jsx(k,{to:"/listings",children:i("common.listings")}),t.category&&e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})}),e.jsx(k,{to:`/categories/${t.category.slug}`,children:t.category.name})]}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})}),e.jsx("span",{children:t.title})]}):null,Ae=({isOpen:t,onClose:i,onConfirm:s,selectedDuration:c,onDurationChange:n,isProcessing:u,t:l})=>{if(!t)return null;const _=[{value:"day",label:l("listing.featureDuration.day"),price:5},{value:"week",label:l("listing.featureDuration.week"),price:25},{value:"month",label:l("listing.featureDuration.month"),price:80}],j=d=>{const m=new Date;let v=new Date(m);switch(d){case"day":v.setDate(m.getDate()+1);break;case"week":v.setDate(m.getDate()+7);break;case"month":v.setMonth(m.getMonth()+1);break}return v.toLocaleDateString()};return e.jsx("div",{className:"listing-detail-page__modal-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"feature-modal-title",children:e.jsxs("div",{className:"listing-detail-page__modal",children:[e.jsxs("div",{className:"listing-detail-page__modal-header",children:[e.jsx("h3",{id:"feature-modal-title",children:l("listing.featureTitle")}),e.jsx("button",{className:"listing-detail-page__modal-close",onClick:i,disabled:u,"aria-label":l("common.close"),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{className:"listing-detail-page__modal-content",children:[e.jsx("p",{children:l("listing.featureDescription")}),e.jsx("div",{className:"listing-detail-page__feature-options",children:_.map(d=>e.jsxs("div",{className:`listing-detail-page__feature-option ${c===d.value?"is-selected":""}`,onClick:()=>n(d.value),onKeyDown:m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),n(d.value))},tabIndex:0,role:"radio","aria-checked":c===d.value,children:[e.jsxs("div",{className:"listing-detail-page__feature-option-header",children:[e.jsx("h4",{children:d.label}),e.jsx("span",{className:"listing-detail-page__feature-option-price",children:V(d.price)})]}),e.jsx("div",{className:"listing-detail-page__feature-option-details",children:e.jsx("p",{children:l("listing.featureValidUntil",{date:j(d.value)})})})]},d.value))})]}),e.jsxs("div",{className:"listing-detail-page__modal-footer",children:[e.jsx("button",{className:"listing-detail-page__modal-cancel",onClick:i,disabled:u,children:l("common.cancel")}),e.jsx("button",{className:"listing-detail-page__modal-confirm",onClick:s,disabled:u,children:u?e.jsx(U,{size:"small"}):l("listing.confirmFeature")})]})]})})},Be=()=>{var O,$;const{t}=K(),i=re(),{idOrSlug:s}=le(),[c,n]=o.useState(0),{isAuthenticated:u,user:l}=oe(de),[_,j]=o.useState({}),[d,m]=o.useState(!1),[v,N]=o.useState(!1),[b,g]=o.useState("day"),[h,y]=o.useState(new Set),[q,Q]=o.useState(!1),{data:r,isLoading:I,error:L,refetch:S}=ce(s||ge,{refetchOnMountOrArgChange:!1}),[A,{isLoading:B}]=he(),[W,{isLoading:X}]=ue(),[Y,{isLoading:Z}]=me();o.useEffect(()=>{y(new Set)},[s]),o.useEffect(()=>{L&&s&&!I&&S()},[s,L,I,S]),o.useCallback((a,x)=>{a&&a!==f&&a!==ke&&(j(w=>({...w,[a]:x})),x||(H(a,h),y(new Set(h))))},[h]);const ee=o.useCallback(async a=>{var x;if(!(!s||!((x=r==null?void 0:r.data)!=null&&x.id)))try{await A({id:r.data.id,status:a}).unwrap(),a==="deleted"&&i("/listings")}catch(w){console.error("Failed to change status:",w)}},[s,(O=r==null?void 0:r.data)==null?void 0:O.id,A,i]),te=o.useCallback(async()=>{var a;if(!(!s||!((a=r==null?void 0:r.data)!=null&&a.id)))try{await W(r.data.id).unwrap(),i("/listings")}catch(x){console.error("Failed to delete listing:",x)}},[s,($=r==null?void 0:r.data)==null?void 0:$.id,W,i]),ie=o.useCallback(a=>{switch(a){case"active":return"listing-detail-page__status-badge--active";case"pending":return"listing-detail-page__status-badge--pending";case"sold":return"listing-detail-page__status-badge--sold";default:return""}},[]),D=o.useCallback(a=>a?a.startsWith("http")||a.startsWith("data:")?a:F(a):f,[]),se=async()=>{var a;if((a=r==null?void 0:r.data)!=null&&a.id){N(!0);try{await Y({id:r.data.id,duration:b}).unwrap(),m(!1),P.success(t("listing.featureSuccess"))}catch(x){console.error("Error making listing featured:",x),P.error(t("listing.featureError"))}finally{N(!1)}}},p=o.useMemo(()=>(r==null?void 0:r.data)||{},[r]),z=o.useMemo(()=>u&&(l==null?void 0:l.id)===(p==null?void 0:p.userId),[u,l,p]),M=o.useMemo(()=>u&&(l==null?void 0:l.role)==="admin",[u,l]),ae=o.useMemo(()=>z||M,[z,M]),{featuredImage:ne,images:C}=o.useMemo(()=>{if(!r||!r.data)return{featuredImage:null,images:[]};const a=r.data;let x=null,w=[];return a.featuredImage&&!T(a.featuredImage,h)&&(x=D(a.featuredImage)),a.images&&Array.isArray(a.images)&&a.images.length>0&&(w=a.images.filter(E=>E&&!T(E,h)).map(E=>D(E))),x&&w.length===0&&(w=[x]),w.length===0&&(w=[f]),{featuredImage:x,images:w}},[r,D,h]);return I?e.jsx(be,{t}):L||!r||!r.data?e.jsx(ye,{error:L,t,refetch:S}):e.jsxs("div",{className:"listing-detail-page",children:[e.jsxs(pe,{children:[e.jsx("title",{children:p.title?`${p.title} | AzeriMarket`:"Listing Detail | AzeriMarket"}),e.jsx("meta",{name:"description",content:p.description?p.description.slice(0,160):"Listing details on AzeriMarket"})]}),e.jsxs("div",{className:"listing-detail-page__container",children:[e.jsx(Fe,{listing:p,t}),e.jsx("div",{className:"listing-detail-page__content",children:e.jsxs("div",{className:"listing-detail-page__main",children:[e.jsxs("div",{className:"listing-detail-page__left-column",children:[e.jsx("div",{className:"listing-detail-page__gallery-container",children:C&&C.length>0?e.jsx(Ce,{images:C,featuredImage:ne||C[0]||f,onImageError:a=>H(a,h),failedImagesCount:h.size}):e.jsxs("div",{className:"listing-detail-page__no-images",children:[e.jsx("img",{src:f,alt:"No images available",className:"listing-detail-page__placeholder"}),e.jsx("p",{children:"No images available for this listing"})]})}),e.jsx(Me,{description:p.description,t})]}),e.jsxs("div",{className:"listing-detail-page__details",children:[e.jsxs("div",{className:"listing-detail-page__info",children:[e.jsx(Se,{listing:p,getStatusBadgeClass:ie,t}),e.jsx(Ee,{listing:p,t}),e.jsx(Ie,{listing:p,showContactInfo:q,setShowContactInfo:Q,isChangingStatus:B,t})]}),e.jsx(De,{listing:p,canEdit:ae,isAdmin:M,isChangingStatus:B,isDeleting:X,isFeaturing:Z,handleStatusChange:ee,handleDelete:te,setIsFeatureModalOpen:m,t})]})]})})]}),d&&e.jsx(Ae,{isOpen:d,onClose:()=>m(!1),onConfirm:se,selectedDuration:b,onDurationChange:g,isProcessing:v,t})]})},$e=()=>e.jsx(Ne,{children:e.jsx(Be,{})});export{$e as default};

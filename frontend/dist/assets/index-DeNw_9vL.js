import{u as C,a as R,f as S,i as L,e as q,k as U,r as h,y as p,j as e,l as N,F as d,n as $,o as k,p as D}from"./index-Ii0svv0K.js";const A=i=>!!i,z=()=>{const{t:i}=C(),m=R(),r=S(L),{data:u,isLoading:y}=q(),[b,{isLoading:x,isError:T,error:O}]=U(),[s,j]=h.useState({title:"",description:"",price:0,currency:"AZN",condition:"new",location:"",images:[],categoryId:"",contactPhone:(r==null?void 0:r.phone)||"",contactEmail:(r==null?void 0:r.email)||""}),[n,v]=h.useState({}),[g,f]=h.useState([]);h.useEffect(()=>{A(r)||(p.error(i("common.loginRequired")),m("/login"))},[r,m,i]);const o=t=>{const{name:a,value:l}=t.target;j(c=>({...c,[a]:l})),n[a]&&v(c=>({...c,[a]:void 0}))},P=t=>{if(t.target.files){const a=Array.from(t.target.files);if(s.images.length+a.length>10){p.warning(i("listings.maxImagesExceeded",{max:10}));return}j(c=>({...c,images:[...c.images,...a]}));const l=a.map(c=>URL.createObjectURL(c));f(c=>[...c,...l])}},w=t=>{const a=[...s.images];a.splice(t,1),j(F=>({...F,images:a}));const l=g[t],c=[...g];c.splice(t,1),f(c),URL.revokeObjectURL(l)},I=()=>{const t={};return s.title.trim()?s.title.length<5&&(t.title=i("listings.titleTooShort")):t.title=i("listings.titleRequired"),s.description.trim()?s.description.length<20&&(t.description=i("listings.descriptionTooShort")):t.description=i("listings.descriptionRequired"),s.price<=0&&(t.price=i("listings.priceRequired")),s.location.trim()||(t.location=i("listings.locationRequired")),s.categoryId||(t.categoryId=i("listings.categoryRequired")),!s.contactPhone&&!s.contactEmail&&(t.contactPhone=i("listings.contactInfoRequired")),v(t),Object.keys(t).length===0},E=async t=>{var a;if(t.preventDefault(),!I()){const l=document.querySelector(".form-group.error");l&&l.scrollIntoView({behavior:"smooth",block:"center"});return}try{const l={title:s.title,description:s.description,price:s.price,currency:s.currency,condition:s.condition,location:s.location,categoryId:s.categoryId,contactPhone:s.contactPhone,contactEmail:s.contactEmail,slug:s.title.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},c=await b(l).unwrap();p.success(i("listings.creationSuccess")),(a=c.data)!=null&&a.id?m(`/listings/${c.data.id}`):m("/profile")}catch(l){console.error("Error creating listing:",l),p.error(i("listings.creationError"))}};return y?e.jsx(N,{}):e.jsx("div",{className:"create-listing-page",children:e.jsxs("div",{className:"create-listing-container",children:[e.jsx("h1",{className:"page-title",children:i("listings.createTitle")}),e.jsx("p",{className:"page-subtitle",children:i("listings.createSubtitle")}),e.jsxs("form",{onSubmit:E,className:"listing-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"section-title",children:i("listings.basicInfo")}),e.jsxs("div",{className:`form-group ${n.title?"error":""}`,children:[e.jsxs("label",{htmlFor:"title",children:[i("listings.title")," ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"title",name:"title",value:s.title,onChange:o,placeholder:i("listings.titlePlaceholder"),maxLength:100}),n.title&&e.jsxs("div",{className:"error-message",children:[e.jsx(d,{})," ",n.title]})]}),e.jsxs("div",{className:`form-group ${n.description?"error":""}`,children:[e.jsxs("label",{htmlFor:"description",children:[i("listings.description")," ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("textarea",{id:"description",name:"description",value:s.description,onChange:o,placeholder:i("listings.descriptionPlaceholder"),rows:5}),n.description&&e.jsxs("div",{className:"error-message",children:[e.jsx(d,{})," ",n.description]})]}),e.jsxs("div",{className:`form-group ${n.categoryId?"error":""}`,children:[e.jsxs("label",{htmlFor:"categoryId",children:[i("listings.category")," ",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("select",{id:"categoryId",name:"categoryId",value:s.categoryId,onChange:o,children:[e.jsx("option",{value:"",children:i("listings.selectCategory")}),u==null?void 0:u.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),n.categoryId&&e.jsxs("div",{className:"error-message",children:[e.jsx(d,{})," ",n.categoryId]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"section-title",children:i("listings.pricingDetails")}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:`form-group ${n.price?"error":""}`,children:[e.jsxs("label",{htmlFor:"price",children:[i("listings.price")," ",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("div",{className:"price-input-group",children:[e.jsx("input",{type:"number",id:"price",name:"price",value:s.price||"",onChange:o,min:"0",step:"0.01"}),e.jsxs("select",{name:"currency",value:s.currency,onChange:o,children:[e.jsx("option",{value:"AZN",children:"₼ AZN"}),e.jsx("option",{value:"USD",children:"$ USD"}),e.jsx("option",{value:"EUR",children:"€ EUR"})]})]}),n.price&&e.jsxs("div",{className:"error-message",children:[e.jsx(d,{})," ",n.price]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"condition",children:i("listings.condition")}),e.jsxs("select",{id:"condition",name:"condition",value:s.condition,onChange:o,children:[e.jsx("option",{value:"new",children:i("condition.new")}),e.jsx("option",{value:"like-new",children:i("condition.like-new")}),e.jsx("option",{value:"good",children:i("condition.good")}),e.jsx("option",{value:"fair",children:i("condition.fair")}),e.jsx("option",{value:"poor",children:i("condition.poor")})]})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"section-title",children:i("listings.location")}),e.jsxs("div",{className:`form-group ${n.location?"error":""}`,children:[e.jsxs("label",{htmlFor:"location",children:[i("listings.locationLabel")," ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"location",name:"location",value:s.location,onChange:o,placeholder:i("listings.locationPlaceholder")}),n.location&&e.jsxs("div",{className:"error-message",children:[e.jsx(d,{})," ",n.location]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"section-title",children:i("listings.images")}),e.jsx("p",{className:"section-description",children:i("listings.imagesDescription")}),e.jsxs("div",{className:"image-upload-container",children:[e.jsxs("label",{htmlFor:"images",className:"image-upload-label",children:[e.jsx($,{className:"upload-icon"}),e.jsx("span",{children:i("listings.uploadImages")}),e.jsxs("span",{className:"image-count",children:[s.images.length,"/10 ",i("listings.imagesUploaded")]})]}),e.jsx("input",{type:"file",id:"images",name:"images",accept:"image/*",multiple:!0,onChange:P,className:"hidden-input"}),g.length>0&&e.jsx("div",{className:"image-previews",children:g.map((t,a)=>e.jsxs("div",{className:"image-preview-item",children:[e.jsx("img",{src:t,alt:`Preview ${a+1}`}),e.jsx("button",{type:"button",className:"remove-image-btn",onClick:()=>w(a),children:e.jsx(k,{})})]},a))})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{className:"section-title",children:i("listings.contactInfo")}),e.jsxs("div",{className:`form-group ${n.contactPhone?"error":""}`,children:[e.jsx("label",{htmlFor:"contactPhone",children:i("listings.contactPhone")}),e.jsx("input",{type:"tel",id:"contactPhone",name:"contactPhone",value:s.contactPhone,onChange:o,placeholder:i("listings.contactPhonePlaceholder")}),n.contactPhone&&e.jsxs("div",{className:"error-message",children:[e.jsx(d,{})," ",n.contactPhone]}),e.jsx("p",{className:"help-text",children:i("listings.contactInfoHelp")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contactEmail",children:i("listings.contactEmail")}),e.jsx("input",{type:"email",id:"contactEmail",name:"contactEmail",value:s.contactEmail,onChange:o,placeholder:i("listings.contactEmailPlaceholder")})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>m(-1),disabled:x,children:i("common.cancel")}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(N,{size:"small"}),i("common.submitting")]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{}),i("listings.createButton")]})})]})]})]})})};export{z as default};

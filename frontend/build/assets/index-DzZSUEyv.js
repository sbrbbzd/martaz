import{u as F,j as e,L as Z,r as l,a as ie,b as te,c as ae,d as ne,e as le}from"./index-5xEUM_gm.js";import{H as ce}from"./index.esm-5bBGV7pT.js";import{L as re,E as oe}from"./index-1QyoW5zR.js";const U="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2VlZWVlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMThweCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzk5OTk5OSI+UmVzaW0gWcO8a2xlbmVtZWRpPC90ZXh0Pjwvc3ZnPg==",de=({id:_,title:r,slug:n,price:x,currency:a,location:C,condition:L,featuredImage:p,images:u,createdAt:v,isPromoted:N,isFeatured:A,categoryName:t,categorySlug:h,userName:o,userImage:j,className:f})=>{const{t:c}=F(),M=S=>S.toLocaleString("az-AZ"),b=S=>{const m=new Date,D=new Date(S),w=Math.abs(m.getTime()-D.getTime()),g=Math.floor(w/(1e3*60*60*24));if(g===0)return c("date.today");if(g===1)return c("date.yesterday");if(g<7)return c("date.daysAgo",{count:g});if(g<30){const i=Math.floor(g/7);return c("date.weeksAgo",{count:i})}else{const i=Math.floor(g/30);return c("date.monthsAgo",{count:i})}},k=p||(u&&u.length>0?u[0]:U),d=S=>{S.currentTarget.src=U};return e.jsxs("div",{className:`listing-card ${f||""} ${N?"promoted":""} ${A?"featured":""}`,children:[e.jsxs(Z,{to:`/listings/${n}`,className:"listing-card__link",children:[e.jsxs("div",{className:"listing-card__image-container",children:[e.jsx("img",{src:k,alt:r,className:"listing-card__image",onError:d}),N&&e.jsx("span",{className:"listing-card__badge listing-card__badge--promoted",children:c("listing.promoted")}),A&&e.jsx("span",{className:"listing-card__badge listing-card__badge--featured",children:c("listing.featured")})]}),e.jsxs("div",{className:"listing-card__content",children:[e.jsx("h3",{className:"listing-card__title",children:r}),e.jsxs("div",{className:"listing-card__price",children:[M(x)," ",a]}),e.jsxs("div",{className:"listing-card__meta",children:[e.jsxs("div",{className:"listing-card__location",children:[e.jsx("i",{className:"icon-location"})," ",C]}),e.jsx("div",{className:"listing-card__date",children:b(v)})]}),t&&h&&e.jsx(Z,{to:`/categories/${h}`,className:"listing-card__category",children:t}),L&&e.jsx("div",{className:"listing-card__condition",children:c(`condition.${L}`)})]})]}),o&&j&&e.jsxs("div",{className:"listing-card__user",children:[e.jsx("img",{src:j,alt:o,className:"listing-card__user-image",onError:d}),e.jsx("span",{className:"listing-card__user-name",children:o})]})]})},he=({currentPage:_,totalPages:r,onPageChange:n,siblingCount:x=1})=>{const{t:a}=F(),L=(()=>{const u=x*2+3+2;if(r<=u)return Array.from({length:r},(h,o)=>o+1);const v=Math.max(_-x,1),N=Math.min(_+x,r),A=v>2,t=N<r-1;if(!A&&t){const h=3+2*x;return[...Array.from({length:h},(j,f)=>f+1),"...",r]}if(A&&!t){const h=3+2*x;return[1,"...",...Array.from({length:h},(j,f)=>r-h+f+1)]}return A&&t?[1,"...",...Array.from({length:N-v+1},(o,j)=>v+j),"...",r]:[]})();return e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"pagination__button pagination__button--prev",onClick:()=>n(_-1),disabled:_===1,children:a("pagination.prev")}),e.jsx("div",{className:"pagination__numbers",children:L.map((p,u)=>p==="..."?e.jsx("span",{className:"pagination__dots",children:"..."},`dots-${u}`):e.jsx("button",{className:`pagination__number ${_===p?"pagination__number--active":""}`,onClick:()=>n(p),children:p},`page-${p}`))}),e.jsx("button",{className:"pagination__button pagination__button--next",onClick:()=>n(_+1),disabled:_===r,children:a("pagination.next")})]})},me=({show:_,onFilterChange:r,onClearFilters:n,categories:x,currentCategory:a,minPrice:C,maxPrice:L,condition:p,location:u,sort:v,order:N,onLocationChange:A})=>{const{t}=F(),[h,o]=l.useState(C),[j,f]=l.useState(L),[c,M]=l.useState(p),[b,k]=l.useState(u),[d,S]=l.useState(v),[m,D]=l.useState(N);l.useEffect(()=>{o(C),f(L),M(p),k(u),S(v),D(N)},[C,L,p,u,v,N]);const w=()=>{r({minPrice:h,maxPrice:j,condition:c,location:b,sort:d,order:m})},g=(i,I)=>{S(i),D(I),r({minPrice:h,maxPrice:j,condition:c,location:b,sort:i,order:I})};return e.jsxs("div",{className:`filter-sidebar ${_?"filter-sidebar--show":""}`,children:[e.jsxs("div",{className:"filter-sidebar__section",children:[e.jsx("h3",{className:"filter-sidebar__title",children:t("filters.categories")}),e.jsxs("ul",{className:"filter-sidebar__categories",children:[e.jsx("li",{children:e.jsx(Z,{to:"/listings",className:a?"":"active",children:t("filters.allCategories")})}),x.map(i=>e.jsxs("li",{children:[e.jsx(Z,{to:`/categories/${i.slug}`,className:(a==null?void 0:a.id)===i.id?"active":"",children:i.name}),((a==null?void 0:a.id)===i.id||(a==null?void 0:a.parentId)===i.id)&&i.children&&i.children.length>0&&e.jsx("ul",{className:"filter-sidebar__subcategories",children:i.children.map(I=>e.jsx("li",{children:e.jsx(Z,{to:`/categories/${I.slug}`,className:(a==null?void 0:a.id)===I.id?"active":"",children:I.name})},I.id))})]},i.id))]})]}),e.jsxs("div",{className:"filter-sidebar__section",children:[e.jsx("h3",{className:"filter-sidebar__title",children:t("filters.price")}),e.jsxs("div",{className:"filter-sidebar__price",children:[e.jsx("div",{className:"filter-sidebar__price-input",children:e.jsx("input",{type:"number",placeholder:t("filters.min"),value:h,onChange:i=>o(i.target.value),min:"0"})}),e.jsx("div",{className:"filter-sidebar__price-separator",children:"-"}),e.jsx("div",{className:"filter-sidebar__price-input",children:e.jsx("input",{type:"number",placeholder:t("filters.max"),value:j,onChange:i=>f(i.target.value),min:"0"})})]})]}),e.jsxs("div",{className:"filter-sidebar__section",children:[e.jsx("h3",{className:"filter-sidebar__title",children:t("filters.condition")}),e.jsx("div",{className:"filter-sidebar__condition",children:e.jsxs("select",{value:c,onChange:i=>M(i.target.value),children:[e.jsx("option",{value:"",children:t("filters.allConditions")}),e.jsx("option",{value:"new",children:t("condition.new")}),e.jsx("option",{value:"like-new",children:t("condition.like-new")}),e.jsx("option",{value:"good",children:t("condition.good")}),e.jsx("option",{value:"fair",children:t("condition.fair")}),e.jsx("option",{value:"poor",children:t("condition.poor")})]})})]}),e.jsxs("div",{className:"filter-sidebar__section",children:[e.jsx("h3",{className:"filter-sidebar__title",children:t("filters.location")}),e.jsx("div",{className:"filter-sidebar__location",children:e.jsx("input",{type:"text",placeholder:t("filters.locationPlaceholder"),value:b,onChange:i=>k(i.target.value)})})]}),e.jsxs("div",{className:"filter-sidebar__section",children:[e.jsx("h3",{className:"filter-sidebar__title",children:t("filters.sort")}),e.jsxs("div",{className:"filter-sidebar__sort",children:[e.jsx("button",{className:d==="createdAt"&&m==="DESC"?"active":"",onClick:()=>g("createdAt","DESC"),children:t("filters.newest")}),e.jsx("button",{className:d==="createdAt"&&m==="ASC"?"active":"",onClick:()=>g("createdAt","ASC"),children:t("filters.oldest")}),e.jsx("button",{className:d==="price"&&m==="ASC"?"active":"",onClick:()=>g("price","ASC"),children:t("filters.priceLowToHigh")}),e.jsx("button",{className:d==="price"&&m==="DESC"?"active":"",onClick:()=>g("price","DESC"),children:t("filters.priceHighToLow")})]})]}),e.jsxs("div",{className:"filter-sidebar__actions",children:[e.jsx("button",{className:"filter-sidebar__apply",onClick:w,children:t("filters.apply")}),e.jsx("button",{className:"filter-sidebar__clear",onClick:n,children:t("filters.clear")})]})]})},pe=()=>{const _=ie(),r=te(),{t:n}=F(),{categorySlug:x}=ae(),a=new URLSearchParams(_.search),C=parseInt(a.get("page")||"1",10),L=parseInt(a.get("limit")||"12",10),p=a.get("sort")||"createdAt",u=a.get("order")||"DESC",v=a.get("minPrice")||"",N=a.get("maxPrice")||"",A=a.get("condition")||"",t=a.get("location")||"",h=a.get("search")||"",[o,j]=l.useState(C),[f]=l.useState(L),[c,M]=l.useState(p),[b,k]=l.useState(u),[d,S]=l.useState(v),[m,D]=l.useState(N),[w,g]=l.useState(A),[i,I]=l.useState(t),[P,T]=l.useState(h),[R,J]=l.useState(!1),{data:E,isLoading:X,error:q,refetch:V}=ne({page:o,limit:f,sort:c,order:b,category:x,minPrice:d?parseInt(d):void 0,maxPrice:m?parseInt(m):void 0,condition:w||void 0,location:i||void 0,search:P||void 0}),{data:$,isLoading:Y}=le(void 0),W=x&&$&&$.find(s=>s.slug===x)||null;l.useEffect(()=>{const s=new URLSearchParams;o!==1&&s.set("page",o.toString()),f!==12&&s.set("limit",f.toString()),c!=="createdAt"&&s.set("sort",c),b!=="DESC"&&s.set("order",b),d&&s.set("minPrice",d),m&&s.set("maxPrice",m),w&&s.set("condition",w),i&&s.set("location",i),P&&s.set("search",P),r(`${_.pathname}?${s.toString()}`,{replace:!0})},[o,f,c,b,d,m,w,i,P,r,_.pathname]),l.useEffect(()=>{j(1)},[d,m,w,i,P,x]);const K=s=>{j(s),window.scrollTo(0,0)},ee=s=>{S(s.minPrice||""),D(s.maxPrice||""),g(s.condition||""),I(s.location||""),M(s.sort||"createdAt"),k(s.order||"DESC")},H=s=>{T(s)},y=()=>{S(""),D(""),g(""),I(""),T(""),M("createdAt"),k("DESC")},se=()=>{J(!R)},z=W?n("listings.categoryTitle",{category:W.name}):P?n("listings.searchTitle",{query:P}):n("listings.title");return e.jsxs("div",{className:"listings-page",children:[e.jsxs(ce,{children:[e.jsxs("title",{children:[z," | Mart.az"]}),e.jsx("meta",{name:"description",content:n("listings.description")})]}),e.jsxs("div",{className:"listings-page__header",children:[e.jsx("h1",{className:"listings-page__title",children:z}),e.jsx("button",{className:"listings-page__filter-toggle",onClick:se,children:n(R?"listings.hideFilters":"listings.showFilters")}),e.jsxs("div",{className:"listings-page__search",children:[e.jsx("input",{type:"text",placeholder:n("listings.searchPlaceholder"),value:P,onChange:s=>T(s.target.value),onKeyPress:s=>s.key==="Enter"&&H(P)}),e.jsx("button",{onClick:()=>H(P),children:n("listings.search")})]})]}),e.jsxs("div",{className:"listings-page__content",children:[e.jsx(me,{show:R,onFilterChange:ee,onClearFilters:y,categories:$||[],currentCategory:W,minPrice:d,maxPrice:m,condition:w,location:i,sort:c,order:b,onLocationChange:s=>I(s)}),e.jsx("div",{className:"listings-page__main",children:X||Y?e.jsx(re,{}):q?e.jsx(oe,{message:n("common.errorOccurred"),onRetry:V}):e.jsx(e.Fragment,{children:E&&E.results.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"listings-page__count",children:n("listings.resultsCount",{count:E.count})}),e.jsx("div",{className:"listings-page__grid",children:E.results.map(s=>{var O,B,G,Q;return e.jsx(de,{id:s.id,title:s.title,slug:s.slug,price:s.price,currency:s.currency,location:s.location,condition:s.condition,featuredImage:s.featuredImage,images:s.images,createdAt:s.createdAt,isPromoted:s.isPromoted,isFeatured:s.isFeatured,categoryName:(O=s.category)==null?void 0:O.name,categorySlug:(B=s.category)==null?void 0:B.slug,userName:(G=s.user)==null?void 0:G.firstName,userImage:(Q=s.user)==null?void 0:Q.profileImage},s.id)})}),E.totalPages>1&&e.jsx(he,{currentPage:o,totalPages:E.totalPages,onPageChange:K})]}):e.jsxs("div",{className:"listings-page__empty",children:[e.jsx("h3",{children:n("listings.noResults")}),e.jsx("p",{children:n("listings.tryDifferentFilters")}),e.jsx("button",{onClick:y,children:n("listings.clearFilters")})]})})})]})]})};export{pe as default};
//# sourceMappingURL=index-DzZSUEyv.js.map
